{% assign docs_by_category_array = "" | split: ',' %}
{% assign docs_by_tag_array = "" | split: ',' %}

<h3>DOCS</h3>
{% for doc in site.data.docs.docs %}
<h4>DOC {{ doc|dump }}</h4>
  {% for tag in doc.tags %}
    {% assign downcasetag = tag | downcase %}
    {% if downcasetag == page.object %}        
      {% assign docs_by_tag_array = docs_by_tag_array | push: doc %}
      {%- break -%}
    {% endif %}
  {% endfor %}
{% endfor %}

{% comment %} create metatitles array to filter duplicated docs in next cycle {% endcomment %}
{% assign doc_metatitles = docs_by_tag_array | map: 'metaname' %}

{% for doc in site.data.docs.docs %}
  {% if doc.tema == page.tema %}
  {% comment %} add docs only if not yet present {% endcomment %}
    {% unless doc_metatitles contains doc.metaname %}
      {% assign docs_by_category_array = docs_by_category_array | push: doc %}
    {% endunless %}
  {% endif %}
{% endfor %}

<div class="u-text-r-s u-layout-wide">
  <div class="u-color-white u-border-top-xxs u-border-bottom-xxs">
    <ul class="Linklist Linklist--padded Treeview Treeview--default js-Treeview u-text-r-xs">
      <li><a target="_blank" href="#">{{ page.title }}</a>
        <ul>
          {% for doc in docs_by_tag_array %}      
            <li><a target="_blank" href="{{ doc.url }}">{{ doc.title }}</a></li>
          {% endfor %}
        </ul>
      </li>
      {% comment %} get the theme's full name {% endcomment %}
      {% assign tema_items = site.data.themes | where_exp: "item", "item.metaname == page.tema" %}
      {% assign tema_item = tema_items[0] %}
      <li><a target="_blank" href="#">{{ tema_item.name }}</a>
        <ul>
          {% for doc in docs_by_category_array %}      
            <li><a target="_blank" href="{{ doc.url }}">{{ doc.title }}</a></li>
          {% endfor %}
        </ul>
      </li>
    </ul>
  </div>
</div>



{% for doc in docs_by_tag_array %}
<!-- accordion header -->
<div class="collapse-header" id="accordion-header-{{ forloop.index }}">
  <button class="h5" data-toggle="collapse" data-target="#accordion-panel-{{ forloop.index }}" aria-expanded="false" aria-controls="accordion-panel-{{ forloop.index }}">{{ page.title }}</button>
</div>

<!-- accordion body -->
<div id="accordion-panel-{{ forloop.index }}" class="collapse" role="tabpanel" aria-labelledby="accordion-header-{{ forloop.index }}">
  <div class="collapse-body" markdown="1">

    {% capture accordion-content %}{% include schede/{{page.object}}/accordion/{{ accordion.file }} %}{% endcapture %}
    {{ accordion-content | markdownify }}

  </div>
</div>

{% endfor %}